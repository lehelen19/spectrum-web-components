{"version":3,"file":"swc.CudfJIlz.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js"],"sourcesContent":["\"use strict\";function o(i,e,t){return typeof i===e?()=>i:typeof i==\"function\"?i:t}export class FocusGroupController{constructor(e,{direction:t,elementEnterAction:n,elements:s,focusInIndex:r,isFocusableElement:h,listenerScope:c}={elements:()=>[]}){this._currentIndex=-1;this.prevIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.prevIndex=this.currentIndex,this.currentIndex=n>-1?n:this.currentIndex,this.isRelatedTargetOrContainAnElement(e)&&this.hostContainsFocus()};this.handleClick=()=>{var n;const e=this.elements;if(!e.length)return;let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))};this.handleFocusout=e=>{this.isRelatedTargetOrContainAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventCode(e.code)||e.defaultPrevented)return;let t=0;switch(this.prevIndex=this.currentIndex,e.code){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.host=e,this.host.addController(this),this._elements=s,this.isFocusableElement=h||this.isFocusableElement,this._direction=o(t,\"string\",this._direction),this.elementEnterAction=n||this.elementEnterAction,this._focusInIndex=o(r,\"number\",this._focusInIndex),this._listenerScope=o(c,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}focus(e){var s;const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&((s=t[this.prevIndex])==null||s.setAttribute(\"tabindex\",\"-1\"),n.tabIndex=0,n.focus(e))}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t;this.prevIndex=this.currentIndex;let s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetOrContainAnElement(e){const t=e.relatedTarget,n=this.elements.includes(t),s=this.elements.some(r=>r.contains(t));return!(n||s)}acceptsEventCode(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.addEventListener(\"click\",this.handleClick)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.host.removeEventListener(\"click\",this.handleClick)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n"],"names":["o","i","e","t","FocusGroupController","constructor","direction","elementEnterAction","n","elements","s","focusInIndex","r","isFocusableElement","h","listenerScope","c","this","_currentIndex","prevIndex","_direction","directionLength","_focused","_focusInIndex","_listenerScope","host","offset","recentlyConnected","handleFocusin","isEventWithinListenerScope","composedPath","find","indexOf","currentIndex","isRelatedTargetOrContainAnElement","hostContainsFocus","handleClick","length","setCurrentIndexCircularly","setAttribute","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventCode","code","defaultPrevented","preventDefault","focus","mutationObserver","MutationObserver","handleItemMutation","addController","_elements","cachedElements","focused","focusInElement","includes","clearElementCache","update","unmanage","manage","tabIndex","disconnect","requestAnimationFrame","forEach","observe","attributes","addEventListener","removeEventListener","relatedTarget","some","contains","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated"],"mappings":"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"}